<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selenium vs Puppeteer</title>
    <meta name="Description" content="web developer, photographer, panda">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="pandamakes">
    <link rel="stylesheet" href="/css/materialize.css">
    <link rel="stylesheet" href="/css/github-markdown.css">
    <link rel="stylesheet" href="/css/coverimage.css">
	  <link rel="me" href="https://fosstodon.org/@pandamakes">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
  </head>
  <body class="d-flex flex-column">
    <header class="flex-basis-0 flex-grow-0">

    <nav>
      <div class="nav-wrapper col s12">

        <!-- logo -->
        <a href="/" class="h-100 brand-logo">
          <div class="h-100 valign-wrapper ">
            <img class="h-100 p-1" src="/img/logo.svg">
            <span>
              pandamakes
            </span>
          </div>
        </a>

        <a href="#" data-target="mobile-menu" class="sidenav-trigger">
          <i class="fas fa-bars"></i>
        </a>

        <ul class="right hide-on-med-and-down"><li class="nav-item"><a href="/">Home</a></li>
<li class="nav-item"><a href="/blog/">Blog</a></li>
<li class="nav-item"><a href="/portfolio/">Portfolio</a></li>
<li class="nav-item"><a href="/about/">About</a></li></ul>
      </div>
    </nav>

  <!-- mobile sidenav -->
  <ul class="sidenav" id="mobile-menu">
  
  
    <li class="nav-item">
      <a href="/">
        Home
      </a>
    </li>
  
  
  
    <li class="nav-item">
      <a href="/blog/">
        Blog
      </a>
    </li>
  
  
  
    <li class="nav-item">
      <a href="/portfolio/">
        Portfolio
      </a>
    </li>
  
  
  
    <li class="nav-item">
      <a href="/about/">
        About
      </a>
    </li>
  
  
  </ul>

</header>

    <main class="flex-basis-0 flex-grow-1" >

      <div data-bgimgsrc="/img/cover.jpg" class="banner-image-wrapper w-100 h-100vh overflow-hidden d-flex align-items-center justify-content-center">
  <div>
    <h1 class="center-align">
      Selenium vs Puppeteer
    </h1>

    
  </div>
</div>

<div class="row"></div>
      <div class="container">
        

<div class="row">
	<div class="col s12"
		<time datetime="2020-02-14">14 February 2020</time>
	</div>
	
  	
<div class="col s12">
  <div class="d-flex flex-wrap">

    
    <span class="mt-a mb-a"> tags: </span>
    

    
    <span data-href="/tags/javascript/" class="waves-effect chip m-1">javascript</span>
    <span data-href="/tags/testing/" class="waves-effect chip m-1">testing</span>
    <span data-href="/tags/e2e/" class="waves-effect chip m-1">e2e</span>
  </div>
</div>



</div>


<div class="row">
  <div class="col s12 markdown-body">
  <p>Lately, I have been working on e2e test of an angular application.</p>
<p>Natively, angular CLI appears to use protractor, selenium and jasmine. However, I am been more familiar with mocha, chai and puppeteer. Thus began the debugging cycle.</p>
<h2 id="issue-1-lacking-visual-feedback" tabindex="-1">Issue 1: Lacking visual feedback <a class="header-anchor" href="#issue-1-lacking-visual-feedback">#</a></h2>
<p>After much research, I came to the conclusion that whilst it <a href="https://stackoverflow.com/a/52765728/6059235">certainly appears</a> that you can write puppeteer tests, in non-headless mode, the chrome window simply does not navigate to the page(s) you instruct it to. My guess is that protractor internally uses selenium. By specifying the binary executable path, protractor opens a Chrome window. But <code>puppeteer.launch</code> will launch a separate chrome instance. Puppeteer API interacts with the latter and webdriver API interacts with the former. Whilst your tests will still pass/fail as you would expect, debugging them becomes a much more difficult task.</p>
<p>So I could:</p>
<ul>
<li>Use protractor and learn selenium web driver API</li>
<li>Use protractor and use puppeteer in effective headless mode</li>
<li>Use mocha, chai and puppeteer</li>
</ul>
<p>After much back and forth, I have decided to use jasmine and selenium. Hopefully, in the future, it should be easier to distribute e2e tests via selenium grid. It should also allow tests to be written in other languages.</p>
<p>I have abstracted away the selenium webdriver API, so in principle, implementing puppeteer should be relatively simple.</p>
<h2 id="issue-2-debugging-http-requests" tabindex="-1">Issue 2: Debugging HTTP requests <a class="header-anchor" href="#issue-2-debugging-http-requests">#</a></h2>
<p>In e2e tests, one of the test conditions is given the navigation to a URL, the application should make a HTTP GET request. For puppeteer, there is <a href="https://github.com/puppeteer/puppeteer/blob/master/docs/api.md#pagesetrequestinterceptionvalue">page.setRequestInterception(value)</a> . For selenium ... nothing?</p>
<p>At the end, I had to resort to proxy'ing <code>XMLHttpRequest.prototype.open</code>. (edit: the idea came from <a href="https://gist.github.com/chmanie/e616ef3b9d20321943e8">this gist</a>) Even then, it was not straight forward. <code>webdriver.get</code> instantiate a new window for me, and thus overwrites any previous proxying of <code>XMLHttpRequest.prototype.open</code>. So I had to hack it by synchronously patching the method, after <code>webdriver.get</code> call was made.</p>

  </div>
</div>
<ul class="links-nextprev"><li>Previous: <a href="/posts/2020-02-01-gl-matrix-bug/">glMatrix bug - mat4.getRotation when matrix has scaling component</a></li><li>Next: <a href="/posts/2020-03-02-protractor-strangies/">Protractor Strangies</a></li>
</ul>

      </div>
    </main>

    <footer class="page-footer flex-basis-0 flex-grow-0">

  <div class="container">
    <div class="row">
      <div class="col s12">

        <a class="btn-flat" href="https://github.com/xgui3783">
          <i class="fab fa-github"></i>
          <span>
            xgui3783
          </span>
        </a>

        <a href="https://fosstodon.org/@pandamakes" class="btn-flat">
          <i class="fab fa-mastodon"></i>
          <span>
            @pandamakes@fosstodon.org
          </span>
        </a>
      </div>
    </div>
  </div>
  
  <div class="footer-copyright">
    <div class="container">
    Â© 2024 Copyright pandamakes
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {

      /* required for SideBar mobile */
      const elems = document.querySelectorAll('.sidenav')
      const instances = M.Sidenav.init(elems)

      /* required to overcome nested anchor links */
      const divHrefs = document.querySelectorAll('[data-href]')
      for (const divHref of divHrefs ){
        divHref.addEventListener('click', ev => {
          window.open(divHref.dataset.href, '_self')
          ev.stopPropagation()
        })
      }
    })
  </script>

</footer>
    <!-- Current page: /posts/2020-02-14-selenium-vs-puppeteer/ -->
  </body>
</html>
